<#
=================================================================================
Filename:           CVE-2021-1675-PrintNightmare-RevertPrintSpoolerACLRestriction.ps1
Support type:       Upstream Power Pack
Support:            Upstream AB, powerpack@upstream.se Last updated 2021-07-01
=================================================================================
PrintNightmare 0 day. Read more here:
https://www.huntress.com/blog/critical-vulnerability-printnightmare-exposes-windows-servers-to-remote-code-execution
#>

##Begin Remove ACL##
$SID = ([System.Security.Principal.SecurityIdentifier]("S-1-5-18")).Translate([System.Security.Principal.NTAccount]).Value
$PrintersDriverPath = $ENV:windir + '\System32\spool\drivers'
$AccessControlList = (Get-Item -Path $PrintersDriverPath).GetAccessControl('Access')
$AccessRule = New-Object System.Security.AccessControl.FileSystemAccessRule($SID, 'Write', 'ContainerInherit, ObjectInherit', 'None', 'Deny')
$AccessControlList.RemoveAccessRule($AccessRule)
Set-Acl -AclObject $AccessControlList -Path $PrintersDriverPath
